# 第六章 无线网络与移动网络

[toc]

## 6.1 概述

1. 无线链路：主机可以通过无线通讯链路连接到一个基站或另一台无线主机，两个主要特性为：**覆盖区域和链路速率**。
2. 基站：无线网络基础设施的一个关键部分，没有明确的对应设备，**它负责向与之关联的无线主机发送数据和接收数据**，通常用于协调多无线主机的传输。蜂窝塔和802.11中无线LAN的接入点都是基站。
3. 自组织网络：无线主机之间没有基站这样的基础设施链接，有则为基础设施模式网络。
4. 切换（Hand off）：一台移动主机移动范围超出一个基站的覆盖范围而到达另一个基站的覆盖范围之后，它将改变其接入更大网络的连接点。
5. 对无线网络进行分类的两个准则：
   1. 分组是否跨越一个无线跳或多个无线跳
   2. 网络中是否存在诸如基站的基础设施

## 6.2 无线链路和网络特征

6. 有线链路同无线链路的重要区别：（有线无线网络的重要差别体现在链路层）
   1. **递减的信号强度**：电磁波穿过物体强度会减弱。且在自由空间中，信号将扩散，意味着信号强度随距离的增加而减弱。
   2. **其他源的干扰**：在同一个频段发送信号的电波源会互相干扰，环境中的电磁噪声也会产生干扰。
   3. **多路径传播**：电磁波一部分受物体和地面的反射，在接收方和发送方之间形成了不同长度的路径，称为多径传播，是的接收信号边的模糊。
   
   在无线链路中，**比特错误更加常见**，对此无线链路协议不仅采用CRC，还采用链路层ARQ协议来重传错误帧。

7. **信噪比SNR**：**收到的信号和噪声强度的相对测量**，单位是分贝，**较大的信噪比使接收方更容易从噪声中提取传输的信号**。

   信噪比SNR与比特差错率BER存在关系：SNR越高，BER越低；对于给定SNR，具有高传输率的调制技术具有更高的BER；物理层调制技术的动态选择能用于适配对信号条件的调制技术。

8. **隐藏终端问题**：即两个主机发送的东西产生干扰后，由于环境的物理阻挡，妨碍A和C互相听到对方的传输。（同时信号量本身也在衰减，可能会导致接收方无法检测到碰撞。
9. CDMA 码分多址：在CDMA中，要发送的每一个信号都通过乘以一个信号（编码）的比特来进行编码，这个信号的变化速率（码片速率）比初始数据比特序列速率快得多。CDMA是一个分割协议，划分编码空间，并且给每个节点分配一个专用的代码空间。

## 6.3 Wifi:  802.11无线WLAN

10. IEEE 802.11无线LAN也称为Wifi（无线保真），**有802.11b、802.11a、802.11g几套标准**，它们在频率范围和数据率上限上有区分，但它们都使用**CSMA/CA**，都允许基础设施模式和自组织模式。

### 6.3.1 802.11 体系结构

11. **基本服务集（BBS）：802.11体系的基本构件模块**，一个BBS包含**一个或多个无限站点和一个称为接入点（AP）的中央基站**。多个BBS可以连接到一个交换机或者路由器中，随之连接到因特网中。每个无线站点也都有MAC地址。
12. Wifi丛林：在任意一个位置，在此处无限站点能从两个或多个AP中收到很强的信号。802.11标准要求每个AP周期性地发送信标帧，包含AP的SSID（服务集标识符）和MAC地址，本地站点为了获得因特网接入该AP，扫描11个信道，找出AP所发的信标帧，了解到可用AP后，选择一个AP进行关联。
13. **被动扫描和主动扫描：扫描和监听信标帧的过程称为被动扫描，无线主机也能通过向位于无限主机范围内的所有AP广播探测帧实现主动扫描。**

### 6.3.2 802.11 MAC协议

14. CSMA/CA：**带碰撞避免的载波侦听多路访问**。每个站点在传输之前侦听信道，并且一旦侦听到该信道忙则抑制传输。
15. **以太网和802.11都是MAC协议**，两者的区别在于：
    1. 802.11采用碰撞避免CA而非碰触检测CD
    2. **无线信道具有较高的误比特率**，802.11使用链路层确认/重传**ARQ机制**。
16. 802.11不使用CD而是使用CA的原因：
    1. 检测碰撞CD的要求站点具有同时发送（发送站点自己的信号）和接收（其他站点是否在发送）的能力。**而在802.11适配器上，接收信号的强度远远小于发送信号的强度，接收信号会被覆盖，构建具有检测碰撞能力的硬件难度较大。**
    2. 即使适配器能够同时发送和接收侦听信号，适配器也会因为**隐藏终端和衰减问题**而无法检测所有的碰撞。
17. 链路层确认机制：目的站点在收到一个通过CRC校验的帧后，等待一个短帧时间间隔SIFS，然后发挥一个确认帧，如果发送站点在给定时间内未收到确认帧，则假定出现了错误并重传，使用CSMA/CA协议访问该信道，若在若干固定次数后仍未收到确认，则放弃该帧。
18. 802.11确认机制：
    1. 若初始时监听到信道空闲，则在一个分布式时间间隔DIFS后发送该帧。
    2. 否则，选取一个**随机回退值**并在侦听信道空闲时递减该值，信道忙时计数值不变，
    3. 当计数器为0时，发送整个数据帧并等待确认。
    4. 收到确认则结束，返回第二步发送下一帧，否则重新回到第二步，并从一个更大的范围里取随机值。
19. 从802.11确认机制可以看到：**不同于CSMA/CD，一空闲立即发送，而是使用计数抑制传输即便信道空闲。**原因很简单，假设不等待，多个待发送的一起传输，不得不因为碰撞重传，而802.11的目标证实避免碰撞。
20. RTS和CTS：为了缓解隐藏终端导致的碰撞，802.11允许站点使用段请求发送RTS控制帧和一个允许发送CTS控制帧来预约对新到的访问。

### 6.3.3 IEEE 802.11 帧

21. 802.11帧结构有许多特殊字段：
    1. 有效载荷：通常由一个IP数据报和ARP分组组成
    2. 四个MAC地址字段：地址1是**接收帧的无线站点的MAC地址**、地址2是**传输帧的站点的MAC地址**、地址3是**路由器接口的MAC地址**（因为BBS是一个子网的一部分，经该路由器与其他子网相连）
    3. 序号、持续期和控制字段、CRC：用序号来去让接收方区分新传输的帧和以前帧的重传

### 6.3.4 在相同IP子网中的移动性

22. 在多个BBS之间移动的问题：
    1. 若移动范围指示一个子网内的两个不同BBS，那么它可以保持自己的IP地址和所有正在进行中的TCP连接。
    2. 若移动过程换了路由器，则必须获得新的地址，这个过程将会打断原有的TCP连接。
23. BBS切换过程：对路由器，对交换机

### 6.3.5 802.11中的高级特色

24. 速率适应：根据当前和近期的信道特点自适应地向下选择下面的物理层调制技术。
25. 功率管理：目的是是的节点最下化监听、传输和接收功能等过程的时间量。节点能够睡眠和被唤醒。

### 6.3.6 802.11以外的标准：蓝牙和WiMAX

26. 蓝牙：**802.15.1**网络，以小范围，低功率和低成本运行，是一个自组织网络。
27. WiMAX：**全球微波接入互操作**，IEEE 802.16，通过广阔的区域以可与电缆调制解调器和ADSL网络相比的速率，向大量用户交互无线数据。其体系结构基于基站，以时分多路复用TDM方式运行。

## 6.4 蜂窝因特网接入

### 6.4.1 蜂窝网体系结构

28. 蜂窝：**一个地理区域内被分成许多称作发射区的地理覆盖区域**。每个发射区包含一个基站，负责向、从位于其发射区内的移动站点发送或接收信号
29. 基本网络体系结构：每个基站通过一个有限基础设施连接到一个广域网中。特别的，每个基站连接到一个**移动交换中心**MSC，它负责管理道和来自移动端用户的呼叫的建立和拆除。
30. 空中接口接入技术：在一个给定发射区，多个呼叫为了避免冲突，通常采用频分多路复用或码分多址来分配无线电频谱。

### 6.4.2 蜂窝网标准和技术

## 6.5 移动管理：原理

31. 移动节点的相关概念：
    1. 归属网络：一个移动节点的固定“居所“
    2. 归属代理：在归属网络中代表移动节点执行移动管理功能的实体
    3. 外部网络、被访网络：移动节点当前所在的网络
    4. 外部代理：在外部网络中代表移动节点执行移动管理功能的实体
    5. 通信者：希望与该移动节点通信的实体

### 6.5.1 寻址

32. 为了使用户移动性对网络应用透明，要求一个移动节点在从一个网络移动到另一个网络时保持其他地址不变。当一个移动节点位于一个外部网络时，所有指向此节点固定地址的流量都需要导向外部网络。
33. **一种实现方法就是由移动节点的归属网络来实现，跟踪该节点所在的外部网络。**
34. 外部代理的作用：
    1. 为移动节点创建一个**转交地址**COA，COA的网络部分域外部网络相匹配，因此**一个移动节点有两个IP地址与之相关联，即永久地址和COA**
    2. 告诉归属代理，该移动节点在外部代理的网络中，并且有给定的COA，该COA用于数据报通过外部代理重新选路到移动节点。

### 6.5.2 选路到移动节点

35. 移动节点的间接选路：通信者只是将数据报寻址到移动节点的固定地址，并将数据报发送到网络中，完全不知道节点是否在外部网络。

    归属代理除了负责与外部代理交互以跟踪移动节点的COA外，**监视寻址到某些节点的到达数据报，将其截获并通过移动节点的COA重新选路到移动节点**。（有点像隧道技术）

    ![image-20210707174411027](C:\Users\17727\AppData\Roaming\Typora\typora-user-images\image-20210707174411027.png)

    存在一个低效的问题：三角选路问题

    ![image-20210707173729486](C:\Users\17727\AppData\Roaming\Typora\typora-user-images\image-20210707173729486.png)

36. 移动节点的直接选路：直接选路中，**通信者所在网络中的一个通信这代理先知道该移动节点的COA**，这可以通过询问归属代理得知，**通信者代理直接将数据报通过隧道技术发往移动节点的COA**

    ![image-20210707173843680](C:\Users\17727\AppData\Roaming\Typora\typora-user-images\image-20210707173843680.png)

## 6.6 移动IP

37. 移动IP指支持移动性的因特网体系结构与协议，移动标准由**代理发现、向归属代理注册、数据报间接选路**组成。

    ![image-20210707175119168](C:\Users\17727\AppData\Roaming\Typora\typora-user-images\image-20210707175119168.png)

## 6.7 蜂窝网中的移动性管理

38. GSM网络体系结构：采用间接选路。
    1. 归属网络和被访网络：
       1. 归属网络维护归属位置注册器，包含它的每个用户的永久蜂窝电话号码以及用户信息和用户当前位置。通信者与归属网络中的一个网管移动服务交换中心（归属MSC）联系。
       2. 被访网络维护访问者位置注册器（VLR），包含移动用户的一个表项，随用户的进入和离开而出现和消失。
    2. 一个服务商为用户提供归属网络服务，并向其他蜂窝提供商订购被访网络服务。

### 6.7.1 对移动用户的呼叫的选路

39. ![image-20210707175547599](C:\Users\17727\AppData\Roaming\Typora\typora-user-images\image-20210707175547599.png)

### 6.7.2 GSM中的切换

40. 切换：移动站点在一个呼叫过程中，将其关联的从一个基站改变为另一个基站。两种情况：新旧基站位于一个MSC，位于不同MSC

    ![image-20210707180710186](C:\Users\17727\AppData\Roaming\Typora\typora-user-images\image-20210707180710186.png)

## 6.8 无限和移动性：对高层协议的影响

41. 运输层协议（特别是TCP）在有线和无线网络中有时具有完全不同的性能，原因包括：
    1. **TCP重传**：丢失和出错会导致重传，在移动用户情况下，**丢失可能源于网络拥塞（路由器缓存溢出）或者切换（切换产生时延）**，导致TCP重传
    2. TCP拥塞控制响应（即TCP减小拥塞窗口）：隐含地假设是拥塞而非出错或切换导致的报文丢失
    3. 无线网络比特错误比有线网络更加普遍，**发生出错或切换时没有理由让TCP降低拥塞窗口**。
42. 解决方案：
    1. 本地恢复（针对比特差错）
    2. TCP发送方知晓无线链路
    3. 分离链接（将端到端连接过程划分为移动主机到无线接入点和无线接入点到有线部分两个部分组成）

