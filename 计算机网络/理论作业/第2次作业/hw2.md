## 第二次计算机网络原理作业

姓名：郑有为  学号：19335286



[toc]

#### 1.  中山大学校园网的用户用浏览器访问网页：www.qq.com，请详细论述访问过程涉及到的应用层协议操作，包括 DNS、HTTP 和 Proxy 等。

**具体访问过程：**

1. **DNS域名解析过程**：浏览器抽取出目标网页地址的主机名（这里就指 www.qq.com）提出查询请求，以获取网页地址的 IP。

   1. 查询**浏览器的 DNS 缓存**，若存在该网页地址的 IP 映射，则返回对应的 IP 地址，否则进入下一步骤。

   2. 查询**本地计算机的DNS 缓存**，若存在该网页地址的 IP 映射，则返回对应的 IP 地址，否则进入下一步骤。

   3. 查询**hosts 文件**，若存在该网页地址的 IP 映射，则返回对应的 IP 地址，否则进入下一步骤。

      >hosts 文件：一个记录常用网址域名与其对应的 IP 地址的文件，在我的电脑中的位置：C:\Windows\System32\drivers\etc\hosts 。

   4. 查询**路由器的 DNS 缓存**，若存在该网页地址的 IP 映射，则返回对应的 IP 地址，否则进入下一步骤。

   5. 向**本地DNS服务器**（LDNS）发出请求。本地DNS服务器收到查询时：

      1. 若目的网页地址的 IP 映射包含在本地配置区域资源中，则返回解析结果给客户机；

      2. 若该 IP 映射不包含在本地配置区域资源中，但该服务器缓存已经缓存了目的网页地址的 IP 映射，也则返回解析结果给客户机；

      3. 否则进入下一步骤。

      > 该服务器提供本地互联网接入的一个DNS解析服务，由于用户使用的是校园网，这个本地区的域名服务器是在中山大学内。

   6. 本地 DNS 服务器以 DNS 客户的身份向根域名服务器继续发送查询请求报文，此过程采用迭代查询。

      1. 首先，本地 DNS 服务器**向根 DNS 服务器发送请求**，根 DNS 服务器收到请求后，判断这个域名(.com)对应的顶级域名服务器，并返回该顶级域名服务器的一个IP 给本地 DNS 服务器。
      2. 然后，本地 DNS 服务器收到顶级域名服务器的 IP 信息后，**向顶级域名服务器发送请求**。顶级域名服务器收到请求后，若能解析 IP 地址，则直接将 IP 返回给本地 DNS 服务器；若无法解析，则返回 .com域的下一级 DNS 服务器地址（www.qq.com）给本地 DNS 服务器。
      3. 最后，本地 DNS 服务器获得 www.qq.com 的 IP地址（实际上，该主机名有很多服务器 IP ，其中我连接上了一个 IPv6 格式的地址 ```2402:4e00:1020:1404:0:9227:71a3:83d2```，它的别名是```ins-r23tsuuf.ias.tencent-cloud.net```），并将解析结果返回给客户机；

   >  前五步的查询过程采用递归查询，在每一级返回时会更新上一级的DNS缓存，以便于下一次访问。

   >  第六步查询过程采用的是迭代查询，实际上，即便本地 DNS 服务器的缓存中不存在 www.qq.com 的 IP 地址，也可能储存着顶级域名服务器 .com 的 IP 地址，在迭代过程中，可以省略向根服务器查询顶级域名服务器 IP 地址的过程。

2. **使用 HTTP 获取 Web页面**：浏览器接收来自于 DNS 的 IP 地址后，通过该 IP 地址定位的 HTTP 服务器发起一个 HTTP请求，过程中涉及代理服务器（Web缓存器）的使用。

   1. 浏览器首先建立一个到中山大学的 Web 缓存器（Proxy）的TCP连接，并向 Web 缓存器中的对象发送一个 HTTP 请求报文，报文的方法字段为```GET```。

      > Web缓存器又称为代理服务器，在这个例子中，用户所连接的 Web 缓存器由中山大学提供，所有校园网的用户浏览器都指向它。

   2. Web 缓存器检查本地是否储存了该对象的拷贝，若有且没有过期，则直接使用 HTTP 响应报文 向客户机返回 www.qq.com 的 Web 网页；若没有或已经过期了，则进入下一步。

   3. Web缓存器就对该对象的初始服务器 www.qq.com 建立一个 TCP 连接，连接成功后，发送一个获取 Web 网页对象的 HTTP 请求报文。

   4. 服务器在收到请求报文后，将对应的 Web 页面的文件封装在一个 HTTP 响应报文中，并通过套接字向 Web 缓存器发送响应报文。

   5. Web 缓存器接收到该响应报文后，在本地储存空间中储存一份 www.qq.com 的 Web 网页对象的拷贝，并通过 客户机浏览器与 Web 缓存器的TCP连接，用 HTTP 响应报文向客户机的浏览器发送该拷贝。

   6. 客户机浏览器接收 Web 缓存器的响应报文，关闭 TCP 连接，并从响应报文中提取出 HTML 文件，并显示在浏览器上。

#### 2.  简述电子邮件的三种协议 SMTP、IMAP 和 POP3 的用途，并以使用 Windows 上的 outlook 软件发送和浏览邮件为例说明所涉及的协议操作。

* **SMTP(简单邮件传输协议) 的用途**：
  * 将电子邮件报文从发送方的用户代理传送到发送方的邮件服务器；
  * 将电子邮件报文从发送方的邮件服务器传送到接收方的邮件服务器。
* **POP3(第三版邮局协议)的用途**：
  * 将邮件从接收方的邮件服务器传送至接收方的用户代理。
  * 管理用户账号在邮件服务器上的邮件（保留或删除）。
* **IMAP(因特网邮件访问协议)的用途**：
  * 用户代理可以通过该协议从邮件服务器上获取邮件的信息，下载邮件。
  * 允许用户管理邮件服务器中的邮件，包括建立文件夹、移动文件、删除邮件。
  * 提供用户代理获取报文组件的功能，例如只读取报文首部，或多方MIME报文中的一部分。
* **使用 Outlook 发送邮件（以用户A（A@qq.com）向用户B（B@qq.com）发送邮件为例）**：
  1. A 使用邮件代理程序 Outlook，输入 B 的邮件地址（B@qq.com）撰写邮件，通过 Outlook 发送该邮件。
  2. Outlook 组织报文并发给 A 的发送邮件服务器，报文被送进发送邮件服务器的报文发送队列中。
  3. 发送邮件服务器上的 SMTP 客户端检测到此报文，创建一个运行在 B 的邮件服务器上的 SMTP 服务器的 TCP 连接。
  4. 在 SMTP 握手后， SMTP客户机通过该 TCP 连接发送 A 的邮件报文。
  5. 在 B 的邮箱服务器上， SMTP的服务端接受该报文并将该报文放入 B 的邮箱文件夹中。
* 使用 Outlook 浏览邮件（同样以用户 A 向用户 B 发送邮件，使用 POP3 协议为例）：
  1. 用户 B 首先启动 Outlook， 用户 B 通过输入用户名和密码与 B 的邮件服务器建立连接。
  2. 在 B 的邮件服务器上， SMTP 的服务端接受来自 A的邮件报文并将该报文放入用户 B 对应的邮箱文件夹内。
  3. 用户 A 将邮件发送成功后，通知用户 B 去收取邮件。Outlook 于是就建立与 QQ邮箱的 POP3 服务器的连接，以收取邮件。
  4. Outlook 通过 POP3 协议向接收邮件服务器中的 POP3 服务器发送读取新邮件的请求报文。
  5. POP3 服务器从接收邮件服务器的 B 的邮箱文件夹中取出邮件，然后将邮件通过 POP3 协议回送到Outlook 的收件箱中 。
  6. 用户 B 在 Outlook 中浏览邮件。
* **使用 Outlook 浏览邮件（同样以用户 A 向用户 B 发送邮件，使用 IMAP 协议为例）**：
  1. 用户 B 首先启动 Outlook， 用户 B 通过输入用户名和密码与 B 的邮件服务器建立连接。
  2. 在 B 的邮件服务器上， SMTP 的服务端接受来自 A 的邮件报文并将该报文放入用户 B 对应的邮箱文件夹内。
  3. 位于 B 的邮件服务器的 IMAP 服务端在 143 端口上侦听来自 IMAP 客户端的传入连接请求。
  4. 用户 A 将邮件发送成功后，通知用户 B 去收取邮件。Outlook 于是就向 IMAP 服务端的连接，将计算机上的电子邮件与服务器上的电子邮件同步。
  5. 用户 B 在 Outlook 中浏览邮件。

#### 3. TCP/UDP 实现文件传输程序并开展测试

​			代码和对应的报告已发给助教邮箱。